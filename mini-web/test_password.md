<!--
 * @Author: Await
 * @Date: 2025-06-01 19:29:49
 * @LastEditors: Await
 * @LastEditTime: 2025-06-01 19:31:44
 * @Description: 请填写简介
-->
# 密码输入功能测试指南

## 修复的问题

### 问题1：密码发送后显示明文
- **问题描述**：用户输入密码时显示星号，但发送后在终端中显示明文
- **修复方案**：在Enter键处理时检查密码模式，如果是密码模式则显示星号而非明文
- **验证方法**：执行 `sudo ls` 命令，输入密码后查看终端输出应显示星号

### 问题2：密码需要输入两次才能成功
- **问题描述**：第一次输入密码失败，需要第二次输入才能成功
- **修复方案**：简化后端密码处理逻辑，直接传输用户输入，移除命令回显处理
- **验证方法**：执行 `sudo ls` 命令，第一次输入正确密码应该直接成功

## 测试步骤

### 1. SSH连接测试
1. 连接到SSH服务器
2. 执行命令：`sudo ls`
3. 观察是否显示密码提示（应该有🔐图标）
4. 输入密码（应该显示星号）
5. 按Enter发送（应该显示星号而非明文）
6. 验证命令是否第一次就执行成功

### 2. 密码模式状态测试
1. 输入 `sudo ls`
2. 观察工具栏是否显示"密码输入模式"指示器
3. 输入错误密码
4. 验证是否保持密码模式
5. 输入正确密码
6. 验证是否正确退出密码模式

### 3. 密码历史记录测试
1. 输入 `sudo ls`
2. 输入密码
3. 使用上下箭头键查看命令历史
4. 验证密码不应该出现在命令历史中

## 预期行为

### 密码输入时
- 输入显示为星号 (*)
- 工具栏显示密码模式指示器 (🔐)
- 密码提示行有特殊样式和动画效果

### 密码发送后
- 终端显示星号而非明文
- 密码不加入命令历史
- 第一次输入正确密码就应该成功

### 密码错误时
- 显示错误信息并保持密码模式
- 错误信息有特殊样式（红色+震动动画）
- 继续等待新的密码输入

### 密码成功后
- 自动退出密码模式
- 工具栏密码指示器消失
- 正常显示命令执行结果

## 调试信息

在浏览器控制台中可以看到以下调试信息：
- `检测到密码提示: [password prompt]`
- `发送命令: 密码输入` (密码输入时)
- `密码错误，保持密码模式: [error message]`
- `收到新提示符，退出密码模式: [prompt]`

## 支持的密码提示格式

- `password:`
- `password for`
- `enter password`
- `[sudo] password for`
- `Password:`
- `Password for`
- `password required`
- `enter your password`
- `please enter password`
- `authentication required`
- `sudo password`
- `user password`

## 技术实现要点

### 前端修改
- Enter键处理时检查密码模式
- 密码不加入命令历史
- 增强密码提示检测
- 改进密码模式状态管理

### 后端修改
- 简化SSH/Telnet写入逻辑
- 移除命令回显处理
- 保持密码数据原样传输
- 格式化器只负责识别不负责处理 