/**
 * 终端修复样式表 - 性能优化版
 */

/* 主要终端容器样式 */
.xterm-container,
.xterm-container-fixed,
.terminal-container,
.fixed-terminal {
  position: relative !important;
  width: 100% !important;
  height: 100% !important;
  overflow: hidden !important;
  background-color: #1e1e1e !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  z-index: 1 !important;
  
  /* 性能优化 */
  will-change: transform !important;
  transform: translateZ(0) !important;
  backface-visibility: hidden !important;
}

/* 确保xterm可见 */
.xterm {
  position: relative !important;
  width: 100% !important;
  height: 100% !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  overflow: hidden !important;
  z-index: 5 !important;
  
  /* 性能优化 */
  will-change: transform !important;
  transform: translateZ(0) !important;
  backface-visibility: hidden !important;
}

/* 确保终端屏幕可见 */
.xterm-screen {
  position: relative !important;
  width: 100% !important;
  height: 100% !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  overflow: hidden !important;
  z-index: 1 !important;
  
  /* 性能优化 */
  will-change: transform !important;
  transform: translateZ(0) !important;
  backface-visibility: hidden !important;
}

/* 文本层样式 - 解决黑屏问题的关键 */
.xterm-text-layer {
  visibility: visible !important;
  display: block !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  opacity: 1 !important;
  z-index: 25 !important;
  overflow: visible !important;
  color: inherit !important;
  pointer-events: none !important;
  
  /* 文本渲染优化 */
  text-rendering: optimizeLegibility !important;
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
}

/* 文本层span样式 */
.xterm-text-layer span {
  visibility: visible !important;
  display: inline-block !important;
  opacity: 1 !important;
  position: relative !important;
  transform: none !important;
  min-width: 1px !important; /* 确保空格字符也能正确显示 */
}

/* 行容器样式 */
.xterm-rows {
  visibility: visible !important;
  display: block !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  opacity: 1 !important;
  z-index: 20 !important;
  overflow: visible !important;
  
  /* 性能优化 */
  will-change: contents !important;
  text-rendering: optimizeLegibility !important;
}

/* 关键修复: 每行的样式 */
.xterm-rows > div {
  visibility: visible !important;
  display: block !important;
  white-space: pre !important; /* 改为pre确保终端换行正确显示 */
  position: relative !important;
  overflow: visible !important;
  height: 1.5em !important; /* 增加行高 */
  min-height: 1.5em !important;
  line-height: 1.5 !important; /* 增加行距 */
  margin: 0 !important;
  margin-bottom: 2px !important; /* 添加底部间距 */
  padding-right: 10px !important;
  opacity: 1 !important;
  border-bottom: 1px solid rgba(255,255,255,0.05) !important; /* 添加微弱可见边框增加行间隔 */
  transform: translate3d(0, 0, 0) !important; /* 强制GPU加速 */
  box-sizing: content-box !important; /* 保持元素尺寸稳定 */
}

/* 解决行内span元素可能隐藏的问题 */
.xterm-rows > div > span {
  visibility: visible !important;
  display: inline-block !important;
  opacity: 1 !important;
  position: relative !important;
  transform: none !important;
  min-width: 1px !important; /* 确保所有字符都能显示 */
  max-height: 1.5em !important; /* 匹配行高 */
  line-height: 1.5 !important; /* 确保一致的行高 */
  overflow: visible !important;
}

/* 滚动视口样式 */
.xterm-viewport {
  visibility: visible !important;
  display: block !important;
  position: absolute !important;
  width: 100% !important;
  height: 100% !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  z-index: 1 !important;
  opacity: 1 !important;
  scrollbar-width: thin !important;
  scrollbar-color: #666 #333 !important;
  
  /* 平滑滚动 */
  scroll-behavior: smooth !important;
}

/* 滚动条样式 */
.xterm-viewport::-webkit-scrollbar {
  width: 8px !important;
}

.xterm-viewport::-webkit-scrollbar-track {
  background: #333 !important;
}

.xterm-viewport::-webkit-scrollbar-thumb {
  background-color: #666 !important;
  border-radius: 4px !important;
}

/* 光标层样式 */
.xterm-cursor-layer {
  visibility: visible !important;
  display: block !important;
  position: absolute !important;
  opacity: 1 !important;
  z-index: 30 !important;
  pointer-events: none !important;
}

/* 光标样式 */
.xterm-cursor {
  visibility: visible !important;
  display: block !important;
  opacity: 1 !important;
  z-index: 30 !important;
  position: relative !important;
  animation: blink-cursor 1s step-end infinite !important; /* 添加闪烁动画 */
}

/* 光标闪烁动画 */
@keyframes blink-cursor {
  0%, 100% { opacity: 1 !important; }
  50% { opacity: 0.5 !important; }
}

/* 强制保证光标可见 */
.xterm-cursor {
  display: block !important;
  visibility: visible !important;
  color: #ffffff !important;
  background-color: #ffffff !important;
  opacity: 0.7 !important;
}

/* 装饰容器 */
.xterm-decoration-container {
  z-index: 22 !important;
}

/* 选择层 */
.xterm-selection-layer {
  z-index: 23 !important;
}

/* 辅助功能修复 */
.xterm-accessibility {
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  width: 0 !important;
  height: 0 !important;
  z-index: -1 !important;
}

/* 确保辅助文本区域正确定位 */
.xterm-helper-textarea {
  position: absolute !important;
  opacity: 0.01 !important;
  width: 1px !important;
  height: 1px !important;
  top: 0 !important;
  left: 0 !important;
  z-index: -1 !important;
}

/* 修复特定场景下堆叠的行 */
.fixed-terminal .xterm-rows > div {
  position: relative !important;
  height: 1.5em !important; /* 增加高度 */
  min-height: 1.5em !important;
  line-height: 1.5 !important;
  white-space: pre !important; /* 保持一致性 */
  overflow: visible !important;
  margin-bottom: 2px !important; /* 增加行间距 */
  border-bottom: 1px solid rgba(255,255,255,0.05) !important;
}

/* 隐藏合成视图，避免中文输入问题 */
.composition-view {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  position: absolute !important;
  z-index: -999 !important;
}

/* 确保链接层可见 */
.xterm-link-layer {
  z-index: 24 !important;
  visibility: visible !important;
}

/* 强制设置字体，确保正确渲染 */
.xterm, .xterm-text-layer, .xterm-rows {
  font-family: Consolas, "Liberation Mono", Monaco, "Courier New", monospace !important;
  font-size: 14px !important;
  line-height: 1.3 !important;
  letter-spacing: 0 !important;
  font-feature-settings: "liga" 0 !important; /* 禁用连字功能 */
  text-rendering: optimizeLegibility !important; /* 优化文本渲染 */
  -webkit-font-smoothing: antialiased !important;
  -moz-osx-font-smoothing: grayscale !important;
}

/* 强制显示文本内容 */
.xterm-char-measure-element {
  display: inline-block !important;
  visibility: hidden !important;
  position: absolute !important;
  top: 0 !important;
  left: -9999em !important;
  line-height: normal !important;
  font-family: inherit !important;
  font-size: inherit !important;
}

/* 修复字符元素 */
.xterm-rows span {
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  backface-visibility: hidden !important; /* 防止字符模糊 */
}

/* 添加特定的可见性修复 */
.xterm-fg-15 {
  color: #f0f0f0 !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* 解决亚像素渲染问题 */
.xterm-text-layer, .xterm-rows, .xterm-rows > div {
  -webkit-transform-style: preserve-3d !important;
  transform-style: preserve-3d !important;
}

/* 优化终端固定宽度字符渲染 */
.xterm-rows span {
  font-variant-numeric: tabular-nums !important; /* 使用等宽数字 */
}

/* 修复终端内容闪烁问题 */
.xterm-screen, .xterm-rows {
  animation: none !important;
  transition: none !important;
} 