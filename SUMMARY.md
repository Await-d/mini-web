# Mini-Web é¡¹ç›®å®Œæ•´é…ç½®æ€»ç»“

## ğŸ¯ å®Œæˆçš„ä»»åŠ¡

### 1. Drone CI/CD éƒ¨ç½²é…ç½®
âœ… **ç»Ÿä¸€Dockerfile**: å‰åç«¯æ•´åˆåœ¨å•ä¸€é•œåƒä¸­  
âœ… **å¤šé˜¶æ®µæ„å»º**: ä¼˜åŒ–é•œåƒå¤§å°å’Œæ„å»ºé€Ÿåº¦  
âœ… **Nginxé…ç½®**: é™æ€æ–‡ä»¶æœåŠ¡ + APIåå‘ä»£ç†  
âœ… **Supervisor**: è¿›ç¨‹ç®¡ç†å’ŒæœåŠ¡ç›‘æ§  
âœ… **æ•°æ®æŒä¹…åŒ–**: å…³é”®ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœº  

### 2. å¤šä»“åº“æ”¯æŒ
âœ… **ä¸‰ä¸ªè¿œç¨‹ä»“åº“**:
- origin: `https://gitee.com/await29/mini-web.git` (master)
- github: `https://github.com/Await-d/mini-web.git` (master)  
- god: `http://14.103.238.12:10882/await/god.git` (mini-webåˆ†æ”¯)

âœ… **è‡ªåŠ¨æ¨é€è„šæœ¬**: `push-all.sh` ä¸€é”®æ¨é€åˆ°æ‰€æœ‰ä»“åº“  
âœ… **åˆ†æ”¯ç­–ç•¥**: é€‚é…ä¸åŒä»“åº“çš„åˆ†æ”¯ç»“æ„  

### 3. éƒ¨ç½²é…ç½®æ–‡ä»¶

#### æ ¸å¿ƒæ–‡ä»¶
- **`Dockerfile`** - ç»Ÿä¸€æ„å»ºé…ç½®
- **`.drone.yml`** - ä¸»è¦Droneé…ç½® (masteråˆ†æ”¯)
- **`.drone-god.yml`** - ç§æœ‰ä»“åº“Droneé…ç½® (mini-webåˆ†æ”¯)
- **`nginx/mini-web.conf`** - Nginxåå‘ä»£ç†é…ç½®
- **`.dockerignore`** - æ„å»ºä¼˜åŒ–é…ç½®

#### è¾…åŠ©æ–‡ä»¶  
- **`push-all.sh`** - å¤šä»“åº“æ¨é€è„šæœ¬
- **`test-deployment.sh`** - æœ¬åœ°éƒ¨ç½²æµ‹è¯•è„šæœ¬

#### æ–‡æ¡£æ–‡ä»¶
- **`DEPLOYMENT.md`** - è¯¦ç»†éƒ¨ç½²è¯´æ˜
- **`README-DEPLOYMENT.md`** - å¿«é€Ÿéƒ¨ç½²æŒ‡å—  
- **`GIT-SETUP.md`** - Gitå¤šä»“åº“é…ç½®è¯´æ˜
- **`SUMMARY.md`** - æœ¬æ€»ç»“æ–‡æ¡£

## ğŸš€ éƒ¨ç½²æ–¹å¼

### è‡ªåŠ¨éƒ¨ç½² (æ¨è)
```bash
# æ¨é€åˆ°å¯¹åº”ä»“åº“è§¦å‘Droneè‡ªåŠ¨éƒ¨ç½²
git push origin master    # è§¦å‘Giteeçš„Drone
git push god master:mini-web  # è§¦å‘ç§æœ‰Gitçš„Drone

# æˆ–ä½¿ç”¨ä¸€é”®æ¨é€
./push-all.sh
```

### æœ¬åœ°æµ‹è¯•
```bash
./test-deployment.sh
```

### æ‰‹åŠ¨éƒ¨ç½²
```bash
docker build -t mini-web:latest .
docker run -d --name mini-web-container -p 8090:80 \
  -v /volume1/docker/1panel/apps/local/mini-web/data:/app/data \
  mini-web:latest
```

## ğŸ“‹ éƒ¨ç½²é…ç½®

### ç«¯å£å’Œè·¯å¾„
- **å¤–éƒ¨è®¿é—®**: `http://your-server:8090`
- **å†…éƒ¨ç«¯å£**: 80 (Nginx) + 8080 (åç«¯API)
- **æ•°æ®è·¯å¾„**: `/volume1/docker/1panel/apps/local/mini-web/`

### æ•°æ®å·æŒ‚è½½
```
/volume1/docker/1panel/apps/local/mini-web/
â”œâ”€â”€ data/         # SQLiteæ•°æ®åº“
â”œâ”€â”€ logs/         # åº”ç”¨æ—¥å¿—  
â”œâ”€â”€ configs/      # é…ç½®æ–‡ä»¶
â””â”€â”€ screenshots/  # RDPæˆªå›¾ä¸´æ—¶æ–‡ä»¶
```

### æœåŠ¡æ¶æ„
```
Docker Container
â”œâ”€â”€ Nginx (80) â†’ å‰ç«¯é™æ€æ–‡ä»¶ + APIä»£ç†
â”œâ”€â”€ Go Backend (8080) â†’ APIæœåŠ¡
â””â”€â”€ Supervisor â†’ è¿›ç¨‹ç®¡ç†
```

## ğŸ”§ æ ¸å¿ƒç‰¹æ€§

### Dockeré•œåƒç‰¹æ€§
- **å¤šé˜¶æ®µæ„å»º**: å‰ç«¯(Node.js) + åç«¯(Go) + è¿è¡Œæ—¶(Nginx)
- **è½»é‡çº§**: åŸºäºAlpine Linux
- **è¿›ç¨‹ç®¡ç†**: Supervisorç®¡ç†å¤šä¸ªæœåŠ¡
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨ç›‘æ§æœåŠ¡çŠ¶æ€
- **ç¯å¢ƒé€‚é…**: å®¹å™¨ç¯å¢ƒå˜é‡é…ç½®

### ç½‘ç»œé…ç½®
- **é™æ€æ–‡ä»¶**: Nginxç›´æ¥æœåŠ¡å‰ç«¯æ–‡ä»¶
- **APIä»£ç†**: `/api/*` ä»£ç†åˆ°åç«¯8080ç«¯å£
- **WebSocket**: `/ws/*` æ”¯æŒé•¿è¿æ¥å’Œå‡çº§
- **å‹ç¼©**: Gzipå‹ç¼©å’Œç¼“å­˜ç­–ç•¥
- **å®‰å…¨**: å®‰å…¨å¤´éƒ¨å’Œå†…å®¹ç­–ç•¥

### æ•°æ®ç®¡ç†
- **æŒä¹…åŒ–**: å…³é”®æ•°æ®æŒ‚è½½åˆ°å®¿ä¸»æœº
- **å¤‡ä»½**: å¤šä»“åº“æä¾›ä»£ç å¤‡ä»½
- **æ—¥å¿—**: åº”ç”¨æ—¥å¿—å’Œç³»ç»Ÿæ—¥å¿—åˆ†ç¦»
- **é…ç½®**: æ”¯æŒå¤–éƒ¨é…ç½®æ–‡ä»¶

## ğŸ® ä½¿ç”¨æŒ‡å—

### è®¿é—®æœåŠ¡
- **Webç•Œé¢**: `http://your-server:8090`
- **APIæ¥å£**: `http://your-server:8090/api/`
- **å¥åº·æ£€æŸ¥**: `http://your-server:8090/api/health`

### é»˜è®¤è´¦æˆ·
- **ç®¡ç†å‘˜**: `admin` / `admin123`
- **æ™®é€šç”¨æˆ·**: `user` / `admin123`

### ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep mini-web

# æŸ¥çœ‹æœåŠ¡è¿›ç¨‹  
docker exec mini-web-container supervisorctl status

# æŸ¥çœ‹æ—¥å¿—
docker logs mini-web-container

# é‡å¯æœåŠ¡
docker restart mini-web-container

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it mini-web-container /bin/bash
```

## ğŸ“– ç»ˆç«¯ä¼šè¯åŠŸèƒ½

### æ ¸å¿ƒç‰¹æ€§ (å·²å®Œæˆæµ‹è¯•)
âœ… **ä¼šè¯æŒä¹…åŒ–**: ç»ˆç«¯ä¼šè¯åœ¨WebSocketæ–­å¼€åç»§ç»­ä¿æŒ  
âœ… **æ¶ˆæ¯å†å²**: é‡è¿æ—¶è‡ªåŠ¨é‡æ”¾å†å²æ¶ˆæ¯  
âœ… **è‡ªåŠ¨æ¸…ç†**: è¿‡æœŸä¼šè¯è‡ªåŠ¨é”€æ¯  
âœ… **ç”¨æˆ·éš”ç¦»**: æ¯ä¸ªç”¨æˆ·çš„ä¼šè¯å®Œå…¨éš”ç¦»  
âœ… **å¤šè¿æ¥**: å•ä¸ªä¼šè¯æ”¯æŒå¤šä¸ªWebSocketè¿æ¥  
âœ… **RESTful API**: å®Œæ•´çš„ä¼šè¯ç®¡ç†æ¥å£  

### APIç«¯ç‚¹
- `POST /api/terminal/sessions` - åˆ›å»ºä¼šè¯
- `GET /api/terminal/sessions` - è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
- `GET /api/terminal/sessions/{id}` - è·å–ç‰¹å®šä¼šè¯
- `DELETE /api/terminal/sessions/{id}` - å…³é—­ä¼šè¯
- `GET /api/terminal/sessions/stats` - ä¼šè¯ç»Ÿè®¡
- `WS /ws/terminal/{sessionId}` - WebSocketè¿æ¥

## ğŸ›¡ï¸ å®‰å…¨å’Œç»´æŠ¤

### å®‰å…¨æªæ–½
- **å®¹å™¨éš”ç¦»**: åº”ç”¨è¿è¡Œåœ¨éš”ç¦»çš„å®¹å™¨ç¯å¢ƒä¸­
- **æ•°æ®æŒä¹…åŒ–**: å…³é”®æ•°æ®æŒ‚è½½é˜²æ­¢ä¸¢å¤±
- **å¥åº·ç›‘æ§**: è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œé‡å¯
- **å¤šä»“åº“å¤‡ä»½**: ä»£ç åˆ†å¸ƒåœ¨å¤šä¸ªä»“åº“

### ç»´æŠ¤å»ºè®®
1. **å®šæœŸå¤‡ä»½**: å¤‡ä»½ `/volume1/docker/1panel/apps/local/mini-web/` ç›®å½•
2. **ç›‘æ§æ—¥å¿—**: å®šæœŸæ£€æŸ¥åº”ç”¨å’Œç³»ç»Ÿæ—¥å¿—
3. **æ›´æ–°å¯†ç **: ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
4. **ç‰ˆæœ¬ç®¡ç†**: ä½¿ç”¨Gitæ ‡ç­¾ç®¡ç†ç‰ˆæœ¬
5. **æ€§èƒ½ç›‘æ§**: ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ç«¯å£å†²çª**: æ£€æŸ¥8090ç«¯å£æ˜¯å¦è¢«å ç”¨
2. **ç›®å½•æƒé™**: ç¡®ä¿æŒ‚è½½ç›®å½•æœ‰æ­£ç¡®æƒé™
3. **ç½‘ç»œé—®é¢˜**: æ£€æŸ¥é˜²ç«å¢™å’Œä»£ç†è®¾ç½®
4. **æœåŠ¡å¯åŠ¨å¤±è´¥**: æŸ¥çœ‹Dockerå’ŒSupervisoræ—¥å¿—

### è°ƒè¯•å·¥å…·
```bash
# å®¹å™¨çŠ¶æ€
docker inspect mini-web-container

# ç½‘ç»œè¿æ¥
ss -tlnp | grep :8090

# è¿›ç¨‹çŠ¶æ€
docker exec mini-web-container ps aux

# é…ç½®æ£€æŸ¥
docker exec mini-web-container nginx -t
```

## âœ¨ é¡¹ç›®äº®ç‚¹

1. **å®Œæ•´çš„CI/CDæµç¨‹**: ä»ä»£ç æäº¤åˆ°è‡ªåŠ¨éƒ¨ç½²
2. **å¤šä»“åº“æ”¯æŒ**: çµæ´»çš„ä»£ç ç®¡ç†å’Œå¤‡ä»½ç­–ç•¥
3. **å‰åç«¯æ•´åˆ**: å•ä¸€é•œåƒåŒ…å«å®Œæ•´åº”ç”¨
4. **ç”Ÿäº§å°±ç»ª**: åŒ…å«ç›‘æ§ã€æ—¥å¿—ã€å¥åº·æ£€æŸ¥
5. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„éƒ¨ç½²å’Œç»´æŠ¤æ–‡æ¡£
6. **ç»ˆç«¯åŠŸèƒ½**: åˆ›æ–°çš„ä¼šè¯æŒä¹…åŒ–æœºåˆ¶

## ğŸ“ åç»­è®¡åˆ’

1. **SSL/HTTPS**: æ·»åŠ SSLè¯ä¹¦æ”¯æŒ
2. **ç›‘æ§é›†æˆ**: Prometheus/Grafanaç›‘æ§
3. **æ—¥å¿—èšåˆ**: ELKæˆ–ç±»ä¼¼æ—¥å¿—ç®¡ç†
4. **è‡ªåŠ¨åŒ–æµ‹è¯•**: CI/CDä¸­é›†æˆè‡ªåŠ¨åŒ–æµ‹è¯•
5. **æ‰©å±•éƒ¨ç½²**: æ”¯æŒé›†ç¾¤å’Œè´Ÿè½½å‡è¡¡

---

ğŸ‰ **é¡¹ç›®é…ç½®å®Œæˆï¼** ç°åœ¨å¯ä»¥é€šè¿‡Droneå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ”¯æŒå¤šä»“åº“æ¨é€ï¼Œå¹¶å…·å¤‡å®Œæ•´çš„ç»ˆç«¯ä¼šè¯ç®¡ç†åŠŸèƒ½ã€‚